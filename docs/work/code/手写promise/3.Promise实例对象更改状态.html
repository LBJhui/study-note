<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.Promiseå®ä¾‹å¯¹è±¡æ›´æ”¹çŠ¶æ€-1</title>
  </head>
  <body></body>
  <!--
    1. é€šè¿‡è°ƒç”¨ resolve æ–¹æ³•ï¼Œå¯ä»¥å°† Promise å®ä¾‹åŒ–å¯¹è±¡çš„çŠ¶æ€ä» pending->fulfilled
    2. é€šè¿‡è°ƒç”¨ reject æ–¹æ³•ï¼Œå¯ä»¥å°† Promise å®ä¾‹åŒ–å¯¹è±¡çš„çŠ¶æ€ä» pending->rejected
    3. Promise çš„å®ä¾‹åŒ–å¯¹è±¡çŠ¶æ€ä¸€æ—¦è¢«æ›´æ”¹ï¼Œåˆ™ä¸ä¼šåœ¨ç»§ç»­æ›´æ”¹ï¼ˆåªèƒ½æ›´æ”¹ä¸€æ¬¡ï¼‰æ— è®ºæ˜¯ pending åˆ° fulfilled è¿˜æ˜¯ pending åˆ° rejectedï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šä» fulfilled åˆ° rejected
    4. æŠ›å‡ºå¼‚å¸¸æ˜¯å¯ä»¥å°† Promise å®ä¾‹åŒ–å¯¹è±¡çš„çŠ¶æ€æ›´æ”¹ä¸º rejected
    5. executor æ‰§è¡Œå™¨å‡½æ•°å®šä¹‰çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªå½¢å¼å‚æ•°ï¼Œä¸€ä¸ªæ˜¯resolveï¼Œå¦ä¸€ä¸ªæ˜¯ reject
    6. resolve å’Œ reject æ˜¯ä¸¤ä¸ªå‡½æ•°,è¿™ä¸¤ä¸ªå‡½æ•°è¿˜æ˜¯å›è°ƒå‡½æ•°
  -->
  <script>
    // ç«‹å³æ‰§è¡Œå‡½æ•°ï¼ˆIIFEï¼‰
    // å¥½å¤„ï¼šå¯ä»¥é¿å…å †å¤–éƒ¨çš„å˜é‡é€ æˆæ±¡æŸ“
    ;(function (window) {
      // åªè¦æ˜¯ç»™æ„é€ å‡½æ•°çš„å®ä¾‹åŒ–å¯¹è±¡èº«ä¸Šæ·»åŠ å±æ€§/æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥åœ¨å‡½æ•°ä¸­ this å¯¹è±¡çš„åœ°å€å¼•ç”¨èº«ä¸Šç›´æ¥æ·»åŠ 
      function Promise(executor) {
        // ç»™ Promise æ„é€ å‡½æ•°æ‰€äº§ç”Ÿçš„å®ä¾‹åŒ–å¯¹è±¡èº«ä¸Šæ·»åŠ ä¸¤ä¸ªå±æ€§
        this.PromiseState = 'pending'
        this.PromiseResult = undefined
        // æ–¹æ³•1ï¼šå¯ä»¥ä¿å­˜æƒ³è¦çš„å‡½æ•°ä¸­ this æŒ‡å‘ï¼Œåœ¨å“ªä¸€ä¸ªéœ€è¦çš„å‡½æ•°è¿›è¡Œç›´æ¥ä½¿ç”¨å³å¯
        let _this = this
        /**
         *  å‡½æ•°ä¸­çš„ thisæŒ‡å‘å–å†³äºå‡½æ•°çš„è°ƒç”¨è€…ï¼Œä¹Ÿå°±æ˜¯è¯´è°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°ä¸­çš„ this å°±æŒ‡å‘è°
         *  å‡½æ•°ä¸­ this ä¸å…‰å¯ä»¥å¾—åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­çš„ this æŒ‡å‘ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¿®æ”¹æˆæƒ³è¦çš„ this æŒ‡å‘
         *  ä¿®æ”¹å‡½æ•°ä¸­çš„ this æŒ‡å‘ï¼šcallã€applyã€bind
         *    call å’Œ apply ä¹‹é—´çš„åŒºåˆ«ï¼šåœ¨äºå‡½æ•°ä¸­ä¿®æ”¹å®Œ this æŒ‡å‘ï¼Œå®é™…å‚æ•°ä¼ é€’çš„æ ¼å¼ä¸åŒ
         *      è¯­æ³•ï¼š
         *          å‡½æ•°å.call(æ–°çš„thisæŒ‡å‘, å®é™…å‚æ•°1,å®é™…å‚æ•°2)
         *          å‡½æ•°å.apply(æ–°çš„thisæŒ‡å‘, [å®é™…å‚æ•°1, å®é™…å‚æ•°2...])
         *    call å’Œ apply ä¹‹é—´çš„å…±åŒç‚¹ï¼šåœ¨äºå‡½æ•°ä¸€æ—¦ä¿®æ”¹å®Œæƒ³è¦çš„ this æŒ‡å‘ä¹‹åï¼Œåˆ™å‡½æ•°å°±ä¼šç«‹å³æ‰§è¡Œ
         *
         *    call å’Œ bind ä¹‹é—´çš„åŒºåˆ«ï¼šcall ä¼šç«‹å³æ‰§è¡Œï¼Œbind ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œä¸” bind åªæœ‰è¿”å›å€¼ï¼Œä¸”è¿”å›çš„æ˜¯ä¸åŸå‡½æ•°ç»“æ„ä¸€æ¨¡ä¸€æ ·çš„ä¿®æ”¹å®Œ this æŒ‡å‘çš„æ–°å‡½æ•°
         */
        try {
          executor(
            function (value) {
              this.PromiseState = 'fulfilled'
              this.PromiseResult = value
            }.bind(this),
            function (value) {
              this.PromiseState = 'rejected'
              this.PromiseResult = value
            }.bind(this)
          )
        } catch (error) {
          typeof error === 'object' ? (this.PromiseResult = error.message) : (this.PromiseResult = error)
          this.PromiseState = 'rejected'
        }
      }
      window.Promise = Promise
    })(window)
  </script>
  <script>
    let p = new Promise((resolve, reject) => {
      console.log('æˆ‘æ˜¯Promiseçš„æ‰§è¡Œå™¨å‡½æ•°')
      // resolve(100)
      // reject('error')
      throw new Error('å¼‚å¸¸')
    })
    console.log('%cğŸ‘ p', 'font-size:16px;color:#ffdd4d', p)
  </script>
</html>
