### 2.6 source map

当 `webpack` 打包源代码时，可能会很难追踪到 error(错误) 和 warning(警告) 在源代 码中的原始位置。例如，如果将三个源文件`（ a.js , b.js 和 c.js `）打包到一个` bundle（ bundle.js ）`中，而其中一个源文件包含一个错误，那么堆栈跟踪就会直 接指向到 `bundle.js` 。你可能需要准确地知道错误来自于哪个源文件，所以这种提 示这通常不会提供太多帮助。

开发模式下默认生成的 sourcemap 记录的是生成后代码的位置，不是源代码的位置。

为了更容易地追踪 error 和 warning，JavaScript 提供了 source maps 功能，可以 将编译后的代码映射回原始源代码。如果一个错误来自于 b.js ，source map 就会 明确的告诉你。

`source map`是一种提供源代码到构建后代码映射的技术，如果构建后代码出错了，通过映射关系可以追踪源代码的错误。在 `webpack.config.js` 文件中配置

```js
module.exports = {
  // 在开发模式下追踪代码具体位置
  devtool: 'inline-source-map'
}
```

在浏览器中打开生成的 index.html 文件，并且在控制台查看显示的错误。 错误如下：

![image-20220801204318909](https://i0.hdslb.com/bfs/album/d3781d9fdf212219ba866648976d7582ecf47669.png)

在浏览器里点击 `hellow-world.js:3 `, 查看具体错误：

![image-20220801204341383](https://i0.hdslb.com/bfs/album/4af49847d9f10d0a6706f847e8f8e82cf79672ae.png)

**常用的几种 source-map 类型**

- eval：（默认配置）不会生成 source map 文件，每个模块都封装在 eval 中，并在后面添加`//# sourceURL = xx.js`
  ![image-20220804185833339](https://i0.hdslb.com/bfs/album/5edcc86b74ae214cb9d1510836df76ddc5dfc45b.png)
  当关闭 devtool 时:
  ![image-20220804185931017](https://i0.hdslb.com/bfs/album/2d4d0b0dfba06ff8788681bb5070628660727f87.png)
  当打开 eval 时：会将每个模块都包裹在一个 eval 中。
  ![image-20220804190019946](https://i0.hdslb.com/bfs/album/39a0a4c32314b4c5670110ea087ad61c4b664336.png)

- source-map：生成外部文件，错误代码的准确信息和源代码的错误位置

  额外生成一个 source.map 文件，打包文件 bundle.js 末尾会引入，可以映射源代码。
  ![image-20220804190123054](https://i0.hdslb.com/bfs/album/4cc4399f8fd8778f37302749e860cf5a30dc0be8.png)

- inline-source-map：内联，错误代码的准确信息和源代码的错误位置。在代码底部生成，构建速度比外部文件更快
  不生成映射文件，而是生成一个 dataURL 形式的映射文件放置在 bundle.js 末尾。
  ![image-20220804190606126](https://i0.hdslb.com/bfs/album/dce9d79ae0f02d0a511fb5db5e7ef266d04f3964.png)

- hidden-source-map：生成外部文件，错误代码的原因，没有错误位置，无法追踪源代码错误。
  和 source-map 一样，额外生成一个 source.map 文件，但打包文件 bundle.js 末尾没有引入，也就是不能映射源代码。
  ![image-20220804190537897](https://i0.hdslb.com/bfs/album/e6a4b863be479273ee3e341ac6225f5795786436.png)

- eval-source-map：内联，错误代码的准确信息和源代码的错误位置。每一个文件都生成对应的 source-map
  每个 module 都会通过 eval()来执行，并且生成一个 DataUrl 形式的 url。和 inline-source-map 不同的是，inline-source-map 只会生成一个 dataurl 放置在 bundle.js 的末尾。而 eval()是每个 module 都生成。
  ![image-20220804190710490](https://i0.hdslb.com/bfs/album/d72ea4943ba75e4268cfc05c2f6d8b6f1ed5657e.png)

- cheap-source-map：生成外部文件，错误代码的准确信息和源代码的错误位置。只精确到行
  生成一个没有列信息 column-mapping（实际代码调试时，我们并不需要列信息）的 sourceMaps 文件，需要注意的是，一些需要 loader 编译的代码，如 babel 先编译，再打包的代码，这种配置是不会映射到的。
  ![image-20220804190749749](https://i0.hdslb.com/bfs/album/91a1f809723eea838f835d5f1a62a78ad3edef4c.png)

- cheap-module-source-map：同 cheap-source-map，会将 loader 的 source map 加入
  生成一个没有列信息（column-mapping）的 sourceMaps 文件，同时 loader 的 sourcemap 也会被简化为只包含对应行的。

开发环境和生产环境的要求：

1、开发环境：要求速度快，调试更友好

我们在开发环境时，最推荐采用这种：`cheap-module-source-map`

2、生产环境：`(none)`（省略 `devtool` 选项） - 不生成 source map。这是一个不错的选择。

![image-20220804115913744](https://i0.hdslb.com/bfs/album/dc60e892ce86656cbf63669c251e442d28ec385c.png)
