<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      class SubCookieUtil {
        static get(name, subName) {
          let subCookies = SubCookieUtil.getAll(name)
          return subCookies ? subCookies[subName] : null
        }
        static getAll(name) {
          let cookieName = encodeURIComponent(name) + '=',
            cookieStart = document.cookie.indexOf(cookieName),
            cookieValue = null,
            cookieEnd,
            subCookies,
            parts,
            result = {}
          if (cookieStart > -1) {
            cookieEnd = document.cookie.indexOf('; ', cookieStart)
            if (cookieEnd == -1) {
              cookieEnd = document.cookie.length
            }
            cookieValue = document.cookie.substring(cookieStart + cookieName.length, cookieEnd)
            if (cookieValue.length > 0) {
              subCookies = cookieValue.split('&')
              for (let i = 0, len = subCookies.length; i < len; i++) {
                parts = subCookies[i].split('=')
                result[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1])
              }
              return result
            }
          }
          return null
        }
        static set(name, subName, value, expires, path, domain, secure) {
          let subcookies = SubCookieUtil.getAll(name) || {}
          subcookies[subName] = value
          SubCookieUtil.setAll(name, subcookies, expires, path, domain, secure)
        }
        static setAll(name, subcookies, expires, path, domain, secure) {
          let cookieText = encodeURIComponent(name) + '=',
            subcookieParts = new Array(),
            subName
          for (subName in subcookies) {
            if (subName.length > 0 && subcookies.hasOwnProperty(subName)) {
              subcookieParts.push('${encodeURIComponent(subName)}=${encodeURIComponent(subcookies[subName])}')
            }
          }
          if (subcookieParts.length > 0) {
            cookieText += subcookieParts.join('&')
            if (expires instanceof Date) {
              cookieText += `; expires=${expires.toGMTString()}`
            }
            if (path) {
              cookieText += `; path=${path}`
            }
            if (domain) {
              cookieText += `; domain=${domain}`
            }
            if (secure) {
              cookieText += '; secure'
            }
          } else {
            cookieText += `; expires=${new Date(0).toGMTString()}`
          }
          document.cookie = cookieText
        }
      }

      // 假设document.cookie=data=name=Nicholas&book=Professional%20JavaScript
      // 设置两个子cookie
      SubCookieUtil.set('data', 'name', 'Nicholas')
      SubCookieUtil.set('data', 'book', 'Professional JavaScript')
      // 设置所有子cookie并传入过期时间
      SubCookieUtil.setAll('data', { name: 'Nicholas', book: 'Professional JavaScript' }, new Date('January 1, 2010'))
      // 修改"name"的值并修改整个cookie的过期时间
      SubCookieUtil.set('data', 'name', 'Michael', new Date('February 1, 2010'))

      // 取得所有子cookie
      let data = SubCookieUtil.getAll('data')
      console.log(data.name) // "Nicholas"
      console.log(data.book) // "Professional JavaScript"
      // 取得个别子cookie
      console.log(SubCookieUtil.get('data', 'name')) // "Nicholas"
      console.log(SubCookieUtil.get('data', 'book')) // "Professional JavaScript"
    </script>
  </body>
</html>
